<ion-content [fullscreen]="true">
  <div class="main-content h-dvh bg-whiteSmoke lg:ml-44 xl:ml-60">
    <app-header></app-header>
    <app-sidebar class="fixed bottom-0 left-0 right-0 lg:bottom-[unset] lg:left-[unset] lg:right-[unset] lg:static z-20"></app-sidebar>
    <div class="flex-grow flex flex-col p-4 font-inter relative pb-16 bg-whiteSmoke pt-1 gap-10 lg:gap-12 lg:pt-10 xl:pt-14 xl:px-16 ">
      <div class="flex items-center justify-between">
        <app-page-title [title]="'Board'"></app-page-title>
        <div class="flex items-center gap-8">
          <app-search-input-field class="hidden lg:flex" [placeholder]="'Find a Task'" (input)="onSearch($event)"></app-search-input-field>
          <app-button-filled class="hidden lg:flex" [text]="'Add Task'" [iconName]="'add-outline'" (click)="isAddTaskOpen = true"></app-button-filled>
          <app-button-filled class="flex lg:hidden" [iconName]="'add-outline'" (click)="isAddTaskOpen = true"></app-button-filled>
        </div>
      </div>
      <app-search-input-field class="flex lg:hidden" [placeholder]="'Find a Task'" (input)="onSearch($event)"></app-search-input-field>
      <div class="flex gap-14 flex-col lg:flex-grow">
            <div class="flex gap-0 2xl:gap-8 flex-col lg:flex-row lg:flex-grow">
              <!-- todo -->
              <app-board-section 
                (taskDropped)="onTaskDropped($event)" 
                (openAddTask)="openAddTask($event)"
                (openTaskCard)="openTaskCard($event)"
                [tasks]="todoTasks" 
                [status]="'todo'" 
                [icon]="'titlePlus'"
                [title]="'To do'" 
                class="w-full">
              </app-board-section>
              <!-- in progress -->
              <app-board-section 
                (taskDropped)="onTaskDropped($event)"
                (openAddTask)="openAddTask($event)"
                (openTaskCard)="openTaskCard($event)" 
                [tasks]="inProgressTasks" 
                [status]="'inProgress'"
                [icon]="'titlePlus'" 
                [title]="'In progress'" 
                class="w-full">
              </app-board-section>
              <!-- awaitFeedbackTasks -->
              <app-board-section
                (taskDropped)="onTaskDropped($event)" 
                (openAddTask)="openAddTask($event)"
                (openTaskCard)="openTaskCard($event)"
                [tasks]="awaitFeedbackTasks" 
                [status]="'awaitFeedback'"
                [icon]="'titlePlus'" 
                [title]="'Await feedback'" 
                class="w-full">
              </app-board-section>
              <!-- doneTasks -->
              <app-board-section 
                (taskDropped)="onTaskDropped($event)"
                (openAddTask)="openAddTask($event)"
                (openTaskCard)="openTaskCard($event)"
                [tasks]="doneTasks" 
                [status]="'done'" 
                [title]="'Done'"
                class="w-full">
              </app-board-section>
            </div>
      </div>
    </div>
  </div>
  <div *ngIf="isAddTaskOpen || isTaskOverviewOpen" class="fixed flex w-dvw h-dvh justify-center items-center top-0 left-0 right-0 bg-[#00000080] z-[11]">
    <div *ngIf="isTaskOverviewOpen" class="absolute z-[12] bg-whiteSmoke shadow-taskShadow overflow-auto h-full w-full sm:h-full md:w-[90%] md:h-5/6 md:rounded-3xl lg:h-auto lg:max-h-[75%] lg:w-[80%] 1xl:w-2/5">
      <app-task-card-overview [task]="currentOpenedTask" (editTask)="editTask()" (isCardOpen)="isTaskOverviewOpen = false"></app-task-card-overview>
    </div>
    <div *ngIf="isAddTaskOpen" class="absolute z-[12] bg-whiteSmoke sm:rounded-3xl shadow-taskShadow overflow-auto h-full pb-4 w-full sm:w-[90%] xl:max-w-[1200px] sm:h-5/6 lg:h-auto slide"
    >
      <app-task-card-add
      (isCardOpen)="closeAddTask()"
      (badgeAnimation)="triggerAnimation($event)"
      [subtasks]="subtasks"
      [taskStatus]="taskStatus"
      [isCard]="true"
      [isEditTask]="isEditTask"
      [editTask]="currentOpenedTask"
      class="flex-grow flex flex-col">
      </app-task-card-add>
    </div>
  </div>
</ion-content>

<app-animated-badge *ngIf="badgeAnimation.status" [text]="badgeAnimation.message" [error]="badgeAnimation.error!" class="absolute flex justify-center items-center h-dvh w-dvw bg-[#00000042] z-20 left-0 top-0"></app-animated-badge>
 